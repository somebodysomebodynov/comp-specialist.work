#!/bin/bash

# Скрипт замены номера телефона и имени специалиста
# Телефон: +79119533903 → +79834106205
# Имя: Игорь Любимов → Кирилл Бас

PROJECT_DIR="$(cd "$(dirname "$0")" && pwd)"

echo "=== Замена номера телефона ==="
echo "Старый: +7 (911) 953-39-03"
echo "Новый:  +7 (983) 410-62-05"
echo "Директория: $PROJECT_DIR"
echo ""

# Формат 1: +79119533903 (слитно с +7, используется в href="tel:...")
echo "Замена: +79119533903 → +79834106205"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/+79119533903/+79834106205/g' {} +

# Формат 2: 79119533903 (без +, используется в wa.me ссылках)
echo "Замена: 79119533903 → 79834106205"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's|wa\.me/79119533903|wa.me/79834106205|g' {} +

# Формат 3: +7 (911) 953-39-03
echo "Замена: +7 (911) 953-39-03 → +7 (983) 410-62-05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/+7 (911) 953-39-03/+7 (983) 410-62-05/g' {} +

# Формат 4: 8 (911) 953-39-03
echo "Замена: 8 (911) 953-39-03 → 8 (983) 410-62-05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/8 (911) 953-39-03/8 (983) 410-62-05/g' {} +

# Формат 5: 8(911)953-39-03 (без пробелов)
echo "Замена: 8(911)953-39-03 → 8(983)410-62-05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/8(911)953-39-03/8(983)410-62-05/g' {} +

# Формат 6: 8-911-953-39-03
echo "Замена: 8-911-953-39-03 → 8-983-410-62-05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/8-911-953-39-03/8-983-410-62-05/g' {} +

# Формат 7: +7-911-953-39-03
echo "Замена: +7-911-953-39-03 → +7-983-410-62-05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/+7-911-953-39-03/+7-983-410-62-05/g' {} +

# Формат 8: 8 911 953 39 03 (через пробелы)
echo "Замена: 8 911 953 39 03 → 8 983 410 62 05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/8 911 953 39 03/8 983 410 62 05/g' {} +

# Формат 9: +7 911 953 39 03 (через пробелы)
echo "Замена: +7 911 953 39 03 → +7 983 410 62 05"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/+7 911 953 39 03/+7 983 410 62 05/g' {} +

# Формат 10: 89119533903 (слитно с 8)
echo "Замена: 89119533903 → 89834106205"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/89119533903/89834106205/g' {} +

# ===================================================
# ЗАМЕНА ИМЕНИ СПЕЦИАЛИСТА
# ===================================================
echo ""
echo "=== Замена имени специалиста ==="
echo "Старое: Игорь Любимов"
echo "Новое:  Кирилл Бас"
echo ""

# Полное имя: Игорь Любимов → Кирилл Бас
echo "Замена: Игорь Любимов → Кирилл Бас"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игорь Любимов/Кирилл Бас/g' {} +

# Полное имя в другом падеже (родительный): Игоря Любимова → Кирилла Баса
echo "Замена: Игоря Любимова → Кирилла Баса"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игоря Любимова/Кирилла Баса/g' {} +

# Полное имя (дательный): Игорю Любимову → Кириллу Басу
echo "Замена: Игорю Любимову → Кириллу Басу"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игорю Любимову/Кириллу Басу/g' {} +

# Полное имя (творительный): Игорем Любимовым → Кириллом Басом
echo "Замена: Игорем Любимовым → Кириллом Басом"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игорем Любимовым/Кириллом Басом/g' {} +

# Полное имя (предложный): Игоре Любимове → Кирилле Басе
echo "Замена: Игоре Любимове → Кирилле Басе"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игоре Любимове/Кирилле Басе/g' {} +

# Только имя (именительный): Игорь → Кирилл
# ВАЖНО: заменяем после полного имени, чтобы не сломать "Игорь Любимов"
echo "Замена: Игорь → Кирилл"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игорь/Кирилл/g' {} +

# Только имя (родительный): Игоря → Кирилла
echo "Замена: Игоря → Кирилла"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игоря/Кирилла/g' {} +

# Только имя (дательный): Игорю → Кириллу
echo "Замена: Игорю → Кириллу"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игорю/Кириллу/g' {} +

# Только имя (творительный): Игорем → Кириллом
echo "Замена: Игорем → Кириллом"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игорем/Кириллом/g' {} +

# Только имя (предложный): Игоре → Кирилле
echo "Замена: Игоре → Кирилле"
find "$PROJECT_DIR" -name '*.html' -not -path '*/.idea/*' -not -path '*/.git/*' \
  -exec sed -i '' 's/Игоре/Кирилле/g' {} +

# ===================================================
# ПРОВЕРКА РЕЗУЛЬТАТОВ
# ===================================================
echo ""
echo "=== Проверка: поиск оставшихся вхождений старого телефона ==="
REMAINING_PHONE=$(grep -r "9119533903" "$PROJECT_DIR" --include='*.html' -l 2>/dev/null)
if [ -z "$REMAINING_PHONE" ]; then
    echo "Все вхождения телефона успешно заменены!"
else
    echo "ВНИМАНИЕ! Остались незаменённые вхождения телефона в файлах:"
    echo "$REMAINING_PHONE"
fi

echo ""
echo "=== Проверка: поиск оставшихся вхождений старого имени ==="
REMAINING_NAME=$(grep -r "Игорь\|Любимов" "$PROJECT_DIR" --include='*.html' -l 2>/dev/null)
if [ -z "$REMAINING_NAME" ]; then
    echo "Все вхождения имени успешно заменены!"
else
    echo "ВНИМАНИЕ! Остались незаменённые вхождения имени в файлах:"
    echo "$REMAINING_NAME"
    echo ""
    echo "Контекст:"
    grep -rn "Игорь\|Любимов" "$PROJECT_DIR" --include='*.html'
fi

echo ""
echo "=== Готово ==="
